---
layout: post
title: 'JWT基础概念知识'
date: 2023-01-12
description: 'JWT基础概念知识'
tags: '技术'
--- 

## 什么是JWT？
JWT(JSON Web Token)是目前最流行的跨域认证解决方案,是一种基于 Token 的认证授权机制。 从 JWT 的全称可以看出,JWT 本身也是 Token,一种规范化之后的 JSON 结构的 Token。

JWT 自身包含了身份验证所需要的所有信息,因此,我们的服务器不需要存储 Session 信息。这显然增加了系统的可用性和伸缩性,大大减轻了服务端的压力。

并且,使用 JWT 认证可以有效避免 CSRF(Cross-site request forgerg跨站请求伪造) 攻击,因为 JWT 一般是存在在 localStorage 中,使用 JWT 进行身份验证的过程中是不会涉及到 Cookie 的。

说到 SCRF,我的毕业设计论文是一个疫情实时监测系统,里面的数据我就是采用CSRF方式来爬取的。有兴趣的可以看一看我github库中的Cov库,里面就是这个项目。

如果当时爬取的远程服务器采用JWT做认证授权就能避免我的数据爬取。

## JWT有哪些部分组成？
JWT本质上就是一组字串,通过(`.`)切分成三个为Base64编码的部分:

- Header: 描述 JWT 的元数据,定义了生成签名的算法以及 `token` 的类型。
- Payload: 用于存放实际需要传递的数据
- Signayure(签名): 服务器通过Payload、Header和一个密钥(Secret)使用Header里面指定的签名算法(默认是HMAC SHA256)生成。

JWT 通常是这样的: `xxxxx.yyyyyy.zzzzz`

### Header
Header 通常由两部分组成:
- `typ`(Type): 令牌类型,也就是JWT。
- `alg`(Algorithm): 签名算法,比如HS256

示例:
```json
{
  "alg": "HS256",
  "typ": "JWT"
}
```
JSON 形式的 Header 被转换成 Base64 编码,成为 JWT 的第一部分。

### Payload
Payload 也是 JSON 格式数据,其中包含了 Claims(声明,包含 JWT 的相关信息)。

Claims 分为三种类型: 
- Registered Claims **（注册声明）** : 预定义的一些声明,建议使用,但不是强制性的。
- Public Claims **（公有声明）**  : JWT 签发方可以自定义的声明,但是为了避免冲突,应该在 IANA JSON Web Token Registryopen in new window 中定义它们。
- Private Claims **（私有声明）** : JWT 签发方因为项目需要而自定义的声明,更符合实际项目场景使用。

下面是一些常见的注册声明: 
- `iss`（issuer）：JWT 签发方
- `iat`（issuer at time）：JWT 签发时间
- `sub`（subject）：JWT 主题
- `aud`（audience）：JWT 主题
- `exp`（expiration time）：JWT 的过期时间
- `nbf`（not before time）：JWT 生效时间
- `jti`（JWT ID）：JWT 唯一标识

示例：
```json
{
  "uid": "ff1212f5-d8d1-4496-bf41-d2dda73de19a",
  "sub": "1234567890",
  "name": "John Doe",
  "exp": 15323232,
  "iat": 1516239022,
  "scope": ["admin", "user"]
}
```
Payload 部分默认是不加密的,**一定不要将隐私信息存放在 Payload 当中！！！**
### Signature
Signature 部分是对前两部分的签名，作用是防止 JWT（主要是 payload） 被篡改。

这个签名的生成需要用到：
- Header + Payload。
- 存放在服务端的密钥(一定不要泄露出去)。
- 签名算法。签名的计算公式如下：
```text
HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  secret)
```
算出签名以后，把 Header、Payload、Signature 三个部分拼成一个字符串，每个部分之间用"点"（.）分隔，这个字符串就是 JWT 。

## 如何防止 JWT 被篡改？
有了签名之后，即使 JWT 被泄露或者截获，黑客也没办法同时篡改 Signature 、Header 、Payload。

这是为什么呢？因为服务端拿到 JWT 之后，会解析出其中包含的 Header、Payload 以及 Signature 。服务端会根据 Header、Payload、密钥再次生成一个 Signature。拿新生成的 Signature 和 JWT 中的 Signature 作对比，如果一样就说明 Header 和 Payload 没有被修改。

不过，如果服务端的秘钥也被泄露的话，黑客就可以同时篡改 Signature 、Header 、Payload 了。黑客直接修改了 Header 和 Payload 之后，再重新生成一个 Signature 就可以了。

**密钥一定保管好，一定不要泄露出去。JWT 安全的核心在于签名，签名安全的核心在密钥。**

## 如何加强 JWT 的安全性？
1. 使用安全系数高的加密算法。
2. 使用成熟的开源库，没必要造轮子。
3. JWT 存放在 localStorage 中而不是 Cookue，避免 CSRF 风险。
4. 一定不要将隐私信息存放在 Payload 当中。
5. 必要一定保管好，一定不要泄露出去。JWT 安全的核心在于签名，签名安全的核心在密钥。
6. Payload 要加入 `exp`（JWT的过期时间），永久有效的JWT不合理。并且，JWT的过期时间不易过长。
